!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MonitorSDK=e()}(this,function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}var e={url:"http://127.0.0.1:4000/api",appId:"appId",isImgUpload:!1,batchSize:5};function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}var n="object"==typeof global&&global&&global.Object===Object&&global,o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")(),c=a.Symbol,i=Object.prototype,u=i.hasOwnProperty,s=i.toString,f=c?c.toStringTag:void 0;var p=Object.prototype.toString;var l=c?c.toStringTag:void 0;function b(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":l&&l in Object(t)?function(t){var e=u.call(t,f),r=t[f];try{t[f]=void 0;var n=!0}catch(t){}var o=s.call(t);return n&&(e?t[f]=r:delete t[f]),o}(t):function(t){return p.call(t)}(t)}function y(t){return null!=t&&"object"==typeof t}var h=Array.isArray;function d(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function v(t){if(!d(t))return!1;var e=b(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var j,_=a["__core-js_shared__"],g=(j=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var m=Function.prototype.toString;function w(t){if(null!=t){try{return m.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var x=/^\[object .+?Constructor\]$/,O=Function.prototype,A=Object.prototype,S=O.toString,T=A.hasOwnProperty,U=RegExp("^"+S.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function z(t){return!(!d(t)||(e=t,g&&g in e))&&(v(t)?U:x).test(w(t));var e}function I(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return z(r)?r:void 0}var E=I(a,"WeakMap"),P=Object.create,M=function(){function t(){}return function(e){if(!d(e))return{};if(P)return P(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),D=function(){try{var t=I(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var F=/^(?:0|[1-9]\d*)$/;function k(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&F.test(t))&&t>-1&&t%1==0&&t<e}function L(t,e){return t===e||t!=t&&e!=e}var B=Object.prototype.hasOwnProperty;function N(t,e,r){var n=t[e];B.call(t,e)&&L(n,r)&&(void 0!==r||e in t)||function(t,e,r){"__proto__"==e&&D?D(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}(t,e,r)}function R(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var C=Object.prototype;function H(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||C)}function $(t){return y(t)&&"[object Arguments]"==b(t)}var q=Object.prototype,V=q.hasOwnProperty,W=q.propertyIsEnumerable,G=$(function(){return arguments}())?$:function(t){return y(t)&&V.call(t,"callee")&&!W.call(t,"callee")};var J="object"==typeof exports&&exports&&!exports.nodeType&&exports,K=J&&"object"==typeof module&&module&&!module.nodeType&&module,X=K&&K.exports===J?a.Buffer:void 0,Q=(X?X.isBuffer:void 0)||function(){return!1},Y={};function Z(t){return function(e){return t(e)}}Y["[object Float32Array]"]=Y["[object Float64Array]"]=Y["[object Int8Array]"]=Y["[object Int16Array]"]=Y["[object Int32Array]"]=Y["[object Uint8Array]"]=Y["[object Uint8ClampedArray]"]=Y["[object Uint16Array]"]=Y["[object Uint32Array]"]=!0,Y["[object Arguments]"]=Y["[object Array]"]=Y["[object ArrayBuffer]"]=Y["[object Boolean]"]=Y["[object DataView]"]=Y["[object Date]"]=Y["[object Error]"]=Y["[object Function]"]=Y["[object Map]"]=Y["[object Number]"]=Y["[object Object]"]=Y["[object RegExp]"]=Y["[object Set]"]=Y["[object String]"]=Y["[object WeakMap]"]=!1;var tt="object"==typeof exports&&exports&&!exports.nodeType&&exports,et=tt&&"object"==typeof module&&module&&!module.nodeType&&module,rt=et&&et.exports===tt&&n.process,nt=function(){try{var t=et&&et.require&&et.require("util").types;return t||rt&&rt.binding&&rt.binding("util")}catch(t){}}(),ot=nt&&nt.isTypedArray,at=ot?Z(ot):function(t){return y(t)&&R(t.length)&&!!Y[b(t)]},ct=Object.prototype.hasOwnProperty;function it(t,e){var r=h(t),n=!r&&G(t),o=!r&&!n&&Q(t),a=!r&&!n&&!o&&at(t),c=r||n||o||a,i=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var s in t)!ct.call(t,s)||c&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||k(s,u))||i.push(s);return i}function ut(t,e){return function(r){return t(e(r))}}var st=ut(Object.keys,Object),ft=Object.prototype.hasOwnProperty;function pt(t){return null!=(e=t)&&R(e.length)&&!v(e)?it(t):function(t){if(!H(t))return st(t);var e=[];for(var r in Object(t))ft.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t);var e}var lt=I(Object,"create");var bt=Object.prototype.hasOwnProperty;var yt=Object.prototype.hasOwnProperty;function ht(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function dt(t,e){for(var r=t.length;r--;)if(L(t[r][0],e))return r;return-1}ht.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},ht.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ht.prototype.get=function(t){var e=this.__data__;if(lt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return bt.call(e,t)?e[t]:void 0},ht.prototype.has=function(t){var e=this.__data__;return lt?void 0!==e[t]:yt.call(e,t)},ht.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=lt&&void 0===e?"__lodash_hash_undefined__":e,this};var vt=Array.prototype.splice;function jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}jt.prototype.clear=function(){this.__data__=[],this.size=0},jt.prototype.delete=function(t){var e=this.__data__,r=dt(e,t);return!(r<0)&&(r==e.length-1?e.pop():vt.call(e,r,1),--this.size,!0)},jt.prototype.get=function(t){var e=this.__data__,r=dt(e,t);return r<0?void 0:e[r][1]},jt.prototype.has=function(t){return dt(this.__data__,t)>-1},jt.prototype.set=function(t,e){var r=this.__data__,n=dt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var _t=I(a,"Map");function gt(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function mt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}mt.prototype.clear=function(){this.size=0,this.__data__={hash:new ht,map:new(_t||jt),string:new ht}},mt.prototype.delete=function(t){var e=gt(this,t).delete(t);return this.size-=e?1:0,e},mt.prototype.get=function(t){return gt(this,t).get(t)},mt.prototype.has=function(t){return gt(this,t).has(t)},mt.prototype.set=function(t,e){var r=gt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var wt=ut(Object.getPrototypeOf,Object);function xt(t){var e=this.__data__=new jt(t);this.size=e.size}xt.prototype.clear=function(){this.__data__=new jt,this.size=0},xt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},xt.prototype.get=function(t){return this.__data__.get(t)},xt.prototype.has=function(t){return this.__data__.has(t)},xt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof jt){var n=r.__data__;if(!_t||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new mt(n)}return r.set(t,e),this.size=r.size,this};var Ot="object"==typeof exports&&exports&&!exports.nodeType&&exports,At=Ot&&"object"==typeof module&&module&&!module.nodeType&&module,St=At&&At.exports===Ot?a.Buffer:void 0;St&&St.allocUnsafe;var Tt=Object.prototype.propertyIsEnumerable,Ut=Object.getOwnPropertySymbols,zt=Ut?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,a=[];++r<n;){var c=t[r];e(c,r,t)&&(a[o++]=c)}return a}(Ut(t),function(e){return Tt.call(t,e)}))}:function(){return[]};function It(t){return function(t,e,r){var n=e(t);return h(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,pt,zt)}var Et=I(a,"DataView"),Pt=I(a,"Promise"),Mt=I(a,"Set"),Dt="[object Map]",Ft="[object Promise]",kt="[object Set]",Lt="[object WeakMap]",Bt="[object DataView]",Nt=w(Et),Rt=w(_t),Ct=w(Pt),Ht=w(Mt),$t=w(E),qt=b;(Et&&qt(new Et(new ArrayBuffer(1)))!=Bt||_t&&qt(new _t)!=Dt||Pt&&qt(Pt.resolve())!=Ft||Mt&&qt(new Mt)!=kt||E&&qt(new E)!=Lt)&&(qt=function(t){var e=b(t),r="[object Object]"==e?t.constructor:void 0,n=r?w(r):"";if(n)switch(n){case Nt:return Bt;case Rt:return Dt;case Ct:return Ft;case Ht:return kt;case $t:return Lt}return e});var Vt=Object.prototype.hasOwnProperty;var Wt=a.Uint8Array;function Gt(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}var Jt=/\w*$/;var Kt=c?c.prototype:void 0,Xt=Kt?Kt.valueOf:void 0;function Qt(t,e,r){var n,o,a,c,i,u=t.constructor;switch(e){case"[object ArrayBuffer]":return Gt(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return i=Gt((c=t).buffer),new c.constructor(i,c.byteOffset,c.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t){var e=Gt(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return(a=new(o=t).constructor(o.source,Jt.exec(o))).lastIndex=o.lastIndex,a;case"[object Symbol]":return n=t,Xt?Object(Xt.call(n)):{}}}var Yt=nt&&nt.isMap,Zt=Yt?Z(Yt):function(t){return y(t)&&"[object Map]"==qt(t)};var te=nt&&nt.isSet,ee=te?Z(te):function(t){return y(t)&&"[object Set]"==qt(t)},re="[object Arguments]",ne="[object Function]",oe="[object Object]",ae={};function ce(t,e,r,n,o,a){var c;if(void 0!==c)return c;if(!d(t))return t;var i=h(t);if(i)c=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Vt.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t);else{var u=qt(t),s=u==ne||"[object GeneratorFunction]"==u;if(Q(t))return t.slice();if(u==oe||u==re||s&&!o)c=s?{}:function(t){return"function"!=typeof t.constructor||H(t)?{}:M(wt(t))}(t);else{if(!ae[u])return o?t:{};c=Qt(t,u)}}a||(a=new xt);var f=a.get(t);if(f)return f;a.set(t,c),ee(t)?t.forEach(function(n){c.add(ce(n,e,r,n,t,a))}):Zt(t)&&t.forEach(function(n,o){c.set(o,ce(n,e,r,o,t,a))});var p=i?void 0:It(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(p||t,function(n,o){p&&(n=t[o=n]),N(c,o,ce(n,e,r,o,t,a))}),c}ae[re]=ae["[object Array]"]=ae["[object ArrayBuffer]"]=ae["[object DataView]"]=ae["[object Boolean]"]=ae["[object Date]"]=ae["[object Float32Array]"]=ae["[object Float64Array]"]=ae["[object Int8Array]"]=ae["[object Int16Array]"]=ae["[object Int32Array]"]=ae["[object Map]"]=ae["[object Number]"]=ae[oe]=ae["[object RegExp]"]=ae["[object Set]"]=ae["[object String]"]=ae["[object Symbol]"]=ae["[object Uint8Array]"]=ae["[object Uint8ClampedArray]"]=ae["[object Uint16Array]"]=ae["[object Uint32Array]"]=!0,ae["[object Error]"]=ae[ne]=ae["[object WeakMap]"]=!1;var ie=[];function ue(t){ie.push(t)}function se(){return ce(ie,5)}function fe(){ie=[]}function pe(t){if(navigator.sendBeacon)navigator.sendBeacon(e.url,t);else{var r=new XMLHttpRequest;r.setRequestHeader("Content-Type","application/json"),r.open("POST",e.url,!0),r.send(t)}}function le(t){if(!e.url)throw new Error("请设置上传 url 地址");var n=JSON.stringify({uuid:r(),data:t});e.isImgUpload?function(t){(new Image).src="".concat(e.url,"?data=").concat(encodeURIComponent(t))}(n):window.requestIdleCallback?window.requestIdleCallback(function(){pe(n)},{timeout:3e3}):setTimeout(function(){pe(n)})}function be(t){ue(t);var r=se();r.length>=e.batchSize&&(le(r),fe())}function ye(){be({uuid:r(),type:"behavior",subType:"pv",startTime:Date.now(),pageUrl:location.href,referror:document.referrer}),function(){var t="";window.addEventListener("hashchange",function(e){var n=e.newURL;be({uuid:r(),type:"behavior",subType:"hashchange",startTime:Date.now(),form:t,to:n}),t=n},!0);var e="";window.addEventListener("popstate",function(t){var n=location.href;be({uuid:r(),type:"behavior",subType:"popstate",startTime:Date.now(),form:e,to:n}),e=n},!0)}(),["mousedown","touchstart"].forEach(function(t){window.addEventListener(t,function(e){var n=e.target;n.tagName&&be({uuid:r(),type:"behavior",subType:"click",startTime:Date.now(),target:n.tagName,innerHtml:n.innerHTML,outerHtml:n.outerHTML,width:n.offsetWidth,height:n.offsetHeight,eventType:t,path:e.path})})})}var he={init:function(n){!function(r){if(r&&"object"===t(r))for(var n in e)r[n]&&(e[n]=r[n])}(n),ye(),window.addEventListener("error",function(t){var e=t.target;if(e.src||e.href){var n=e.src||e.href;be({uuid:r(),type:"error",subType:"resource",startTime:Date.now(),url:n,html:e.outerHTML,pageUrl:location.href,path:t.path})}},!0),window.onerror=function(t,e,n,o,a){be({uuid:r(),type:"error",subType:"js",startTime:Date.now(),msg:t,url:e,lineNo:n,columnNo:o,stack:a.stack,pageUrl:location.href})},window.addEventListener("unhandledrejection",function(t){var e;be({type:"error",subType:"promise",startTime:Date.now(),reason:null===(e=t.reason)||void 0===e?void 0:e.stack,pageUrl:location.href})},!0)}};return he});
