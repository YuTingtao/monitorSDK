!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MonitorSDK=e()}(this,function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var t=n.next();return c=t.done,t},e:function(t){u=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(u)throw i}}}}function r(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}var i={api:"http://127.0.0.1:4000/api",appId:"appId",isImgUpload:!1,batchSize:5};function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}var u="object"==typeof global&&global&&global.Object===Object&&global,s="object"==typeof self&&self&&self.Object===Object&&self,f=u||s||Function("return this")(),p=f.Symbol,l=Object.prototype,b=l.hasOwnProperty,y=l.toString,v=p?p.toStringTag:void 0;var d=Object.prototype.toString;var h=p?p.toStringTag:void 0;function j(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":h&&h in Object(t)?function(t){var e=b.call(t,v),r=t[v];try{t[v]=void 0;var n=!0}catch(t){}var o=y.call(t);return n&&(e?t[v]=r:delete t[v]),o}(t):function(t){return d.call(t)}(t)}function g(t){return null!=t&&"object"==typeof t}var _=Array.isArray;function m(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function w(t){if(!m(t))return!1;var e=j(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var O,x=f["__core-js_shared__"],A=(O=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"";var S=Function.prototype.toString;function T(t){if(null!=t){try{return S.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var P=/^\[object .+?Constructor\]$/,U=Function.prototype,E=Object.prototype,I=U.toString,z=E.hasOwnProperty,D=RegExp("^"+I.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function M(t){return!(!m(t)||(e=t,A&&A in e))&&(w(t)?D:P).test(T(t));var e}function F(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return M(r)?r:void 0}var k=F(f,"WeakMap"),L=Object.create,N=function(){function t(){}return function(e){if(!m(e))return{};if(L)return L(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),B=function(){try{var t=F(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var C=/^(?:0|[1-9]\d*)$/;function R(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&C.test(t))&&t>-1&&t%1==0&&t<e}function $(t,e){return t===e||t!=t&&e!=e}var H=Object.prototype.hasOwnProperty;function q(t,e,r){var n=t[e];H.call(t,e)&&$(n,r)&&(void 0!==r||e in t)||function(t,e,r){"__proto__"==e&&B?B(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}(t,e,r)}function V(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var W=Object.prototype;function J(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||W)}function G(t){return g(t)&&"[object Arguments]"==j(t)}var K=Object.prototype,X=K.hasOwnProperty,Q=K.propertyIsEnumerable,Y=G(function(){return arguments}())?G:function(t){return g(t)&&X.call(t,"callee")&&!Q.call(t,"callee")};var Z="object"==typeof exports&&exports&&!exports.nodeType&&exports,tt=Z&&"object"==typeof module&&module&&!module.nodeType&&module,et=tt&&tt.exports===Z?f.Buffer:void 0,rt=(et?et.isBuffer:void 0)||function(){return!1},nt={};function ot(t){return function(e){return t(e)}}nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt["[object Arguments]"]=nt["[object Array]"]=nt["[object ArrayBuffer]"]=nt["[object Boolean]"]=nt["[object DataView]"]=nt["[object Date]"]=nt["[object Error]"]=nt["[object Function]"]=nt["[object Map]"]=nt["[object Number]"]=nt["[object Object]"]=nt["[object RegExp]"]=nt["[object Set]"]=nt["[object String]"]=nt["[object WeakMap]"]=!1;var at="object"==typeof exports&&exports&&!exports.nodeType&&exports,it=at&&"object"==typeof module&&module&&!module.nodeType&&module,ct=it&&it.exports===at&&u.process,ut=function(){try{var t=it&&it.require&&it.require("util").types;return t||ct&&ct.binding&&ct.binding("util")}catch(t){}}(),st=ut&&ut.isTypedArray,ft=st?ot(st):function(t){return g(t)&&V(t.length)&&!!nt[j(t)]},pt=Object.prototype.hasOwnProperty;function lt(t,e){var r=_(t),n=!r&&Y(t),o=!r&&!n&&rt(t),a=!r&&!n&&!o&&ft(t),i=r||n||o||a,c=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=c.length;for(var s in t)!pt.call(t,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||R(s,u))||c.push(s);return c}function bt(t,e){return function(r){return t(e(r))}}var yt=bt(Object.keys,Object),vt=Object.prototype.hasOwnProperty;function dt(t){return null!=(e=t)&&V(e.length)&&!w(e)?lt(t):function(t){if(!J(t))return yt(t);var e=[];for(var r in Object(t))vt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t);var e}var ht=F(Object,"create");var jt=Object.prototype.hasOwnProperty;var gt=Object.prototype.hasOwnProperty;function _t(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function mt(t,e){for(var r=t.length;r--;)if($(t[r][0],e))return r;return-1}_t.prototype.clear=function(){this.__data__=ht?ht(null):{},this.size=0},_t.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},_t.prototype.get=function(t){var e=this.__data__;if(ht){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return jt.call(e,t)?e[t]:void 0},_t.prototype.has=function(t){var e=this.__data__;return ht?void 0!==e[t]:gt.call(e,t)},_t.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ht&&void 0===e?"__lodash_hash_undefined__":e,this};var wt=Array.prototype.splice;function Ot(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ot.prototype.clear=function(){this.__data__=[],this.size=0},Ot.prototype.delete=function(t){var e=this.__data__,r=mt(e,t);return!(r<0)&&(r==e.length-1?e.pop():wt.call(e,r,1),--this.size,!0)},Ot.prototype.get=function(t){var e=this.__data__,r=mt(e,t);return r<0?void 0:e[r][1]},Ot.prototype.has=function(t){return mt(this.__data__,t)>-1},Ot.prototype.set=function(t,e){var r=this.__data__,n=mt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var xt=F(f,"Map");function At(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function St(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}St.prototype.clear=function(){this.size=0,this.__data__={hash:new _t,map:new(xt||Ot),string:new _t}},St.prototype.delete=function(t){var e=At(this,t).delete(t);return this.size-=e?1:0,e},St.prototype.get=function(t){return At(this,t).get(t)},St.prototype.has=function(t){return At(this,t).has(t)},St.prototype.set=function(t,e){var r=At(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Tt=bt(Object.getPrototypeOf,Object);function Pt(t){var e=this.__data__=new Ot(t);this.size=e.size}Pt.prototype.clear=function(){this.__data__=new Ot,this.size=0},Pt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Pt.prototype.get=function(t){return this.__data__.get(t)},Pt.prototype.has=function(t){return this.__data__.has(t)},Pt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Ot){var n=r.__data__;if(!xt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new St(n)}return r.set(t,e),this.size=r.size,this};var Ut="object"==typeof exports&&exports&&!exports.nodeType&&exports,Et=Ut&&"object"==typeof module&&module&&!module.nodeType&&module,It=Et&&Et.exports===Ut?f.Buffer:void 0;It&&It.allocUnsafe;var zt=Object.prototype.propertyIsEnumerable,Dt=Object.getOwnPropertySymbols,Mt=Dt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,a=[];++r<n;){var i=t[r];e(i,r,t)&&(a[o++]=i)}return a}(Dt(t),function(e){return zt.call(t,e)}))}:function(){return[]};function Ft(t){return function(t,e,r){var n=e(t);return _(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,dt,Mt)}var kt=F(f,"DataView"),Lt=F(f,"Promise"),Nt=F(f,"Set"),Bt="[object Map]",Ct="[object Promise]",Rt="[object Set]",$t="[object WeakMap]",Ht="[object DataView]",qt=T(kt),Vt=T(xt),Wt=T(Lt),Jt=T(Nt),Gt=T(k),Kt=j;(kt&&Kt(new kt(new ArrayBuffer(1)))!=Ht||xt&&Kt(new xt)!=Bt||Lt&&Kt(Lt.resolve())!=Ct||Nt&&Kt(new Nt)!=Rt||k&&Kt(new k)!=$t)&&(Kt=function(t){var e=j(t),r="[object Object]"==e?t.constructor:void 0,n=r?T(r):"";if(n)switch(n){case qt:return Ht;case Vt:return Bt;case Wt:return Ct;case Jt:return Rt;case Gt:return $t}return e});var Xt=Object.prototype.hasOwnProperty;var Qt=f.Uint8Array;function Yt(t){var e=new t.constructor(t.byteLength);return new Qt(e).set(new Qt(t)),e}var Zt=/\w*$/;var te=p?p.prototype:void 0,ee=te?te.valueOf:void 0;function re(t,e,r){var n,o,a,i,c,u=t.constructor;switch(e){case"[object ArrayBuffer]":return Yt(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return c=Yt((i=t).buffer),new i.constructor(c,i.byteOffset,i.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t){var e=Yt(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return(a=new(o=t).constructor(o.source,Zt.exec(o))).lastIndex=o.lastIndex,a;case"[object Symbol]":return n=t,ee?Object(ee.call(n)):{}}}var ne=ut&&ut.isMap,oe=ne?ot(ne):function(t){return g(t)&&"[object Map]"==Kt(t)};var ae=ut&&ut.isSet,ie=ae?ot(ae):function(t){return g(t)&&"[object Set]"==Kt(t)},ce="[object Arguments]",ue="[object Function]",se="[object Object]",fe={};function pe(t,e,r,n,o,a){var i;if(void 0!==i)return i;if(!m(t))return t;var c=_(t);if(c)i=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Xt.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t);else{var u=Kt(t),s=u==ue||"[object GeneratorFunction]"==u;if(rt(t))return t.slice();if(u==se||u==ce||s&&!o)i=s?{}:function(t){return"function"!=typeof t.constructor||J(t)?{}:N(Tt(t))}(t);else{if(!fe[u])return o?t:{};i=re(t,u)}}a||(a=new Pt);var f=a.get(t);if(f)return f;a.set(t,i),ie(t)?t.forEach(function(n){i.add(pe(n,e,r,n,t,a))}):oe(t)&&t.forEach(function(n,o){i.set(o,pe(n,e,r,o,t,a))});var p=c?void 0:Ft(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(p||t,function(n,o){p&&(n=t[o=n]),q(i,o,pe(n,e,r,o,t,a))}),i}fe[ce]=fe["[object Array]"]=fe["[object ArrayBuffer]"]=fe["[object DataView]"]=fe["[object Boolean]"]=fe["[object Date]"]=fe["[object Float32Array]"]=fe["[object Float64Array]"]=fe["[object Int8Array]"]=fe["[object Int16Array]"]=fe["[object Int32Array]"]=fe["[object Map]"]=fe["[object Number]"]=fe[se]=fe["[object RegExp]"]=fe["[object Set]"]=fe["[object String]"]=fe["[object Symbol]"]=fe["[object Uint8Array]"]=fe["[object Uint8ClampedArray]"]=fe["[object Uint16Array]"]=fe["[object Uint32Array]"]=!0,fe["[object Error]"]=fe[ue]=fe["[object WeakMap]"]=!1;var le=[];function be(t){le.push(t)}function ye(){return pe(le,5)}function ve(){le=[]}function de(t){if(navigator.sendBeacon)navigator.sendBeacon(i.url,t);else{var e=new XMLHttpRequest;e.setRequestHeader("Content-Type","application/json"),e.open("POST",i.url,!0),e.send(t)}}function he(t){if(!i.url)throw new Error("请设置上传 url 地址");var e=JSON.stringify({uuid:c(),data:t});i.isImgUpload?function(t){(new Image).src="".concat(i.url,"?data=").concat(encodeURIComponent(t))}(e):window.requestIdleCallback?window.requestIdleCallback(function(){de(e)},{timeout:3e3}):setTimeout(function(){de(e)})}function je(t){be(t);var e=ye();e.length>=i.batchSize&&(he(e),ve())}function ge(){var t;(t=new PerformanceObserver(function(r){var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;"first-paint"===i.name&&(t.disconnect(),je(o(o({},i.toJSON()),{},{type:"performance",subType:i.name,pageUrl:location.href})))}}catch(t){a.e(t)}finally{a.f()}})).observe({type:"paint",buffered:!0}),function(){var t=new PerformanceObserver(function(r){var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;"first-contentful-paint"===i.name&&(t.disconnect(),je(o(o({},i.toJSON()),{},{type:"performance",subType:i.name,pageUrl:location.href})))}}catch(t){a.e(t)}finally{a.f()}});t.observe({type:"paint",buffered:!0})}(),function(){var t=new PerformanceObserver(function(r){t&&t.disconnect();var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;je(o(o({},i.toJSON()),{},{type:"performance",subType:i.entryType,pageUrl:location.href}))}}catch(t){a.e(t)}finally{a.f()}});t.observe({type:"largest-contentful-paint",buffered:!0})}()}function _e(){je({uuid:c(),type:"behavior",subType:"pv",startTime:Date.now(),pageUrl:location.href,referror:document.referrer}),function(){var t="";window.addEventListener("hashchange",function(e){var r=e.newURL;je({uuid:c(),type:"behavior",subType:"hashchange",startTime:Date.now(),form:t,to:r}),t=r},!0);var e="";window.addEventListener("popstate",function(t){var r=location.href;je({uuid:c(),type:"behavior",subType:"popstate",startTime:Date.now(),form:e,to:r}),e=r},!0)}(),["mousedown","touchstart"].forEach(function(t){window.addEventListener(t,function(e){var r=e.target;r.tagName&&je({uuid:c(),type:"behavior",subType:"click",startTime:Date.now(),target:r.tagName,innerHtml:r.innerHTML,outerHtml:r.outerHTML,width:r.offsetWidth,height:r.offsetHeight,eventType:t,path:e.path})})})}var me={init:function(t){!function(t){if(t&&"object"===a(t))for(var e in i)t[e]&&(i[e]=t[e])}(t),ge(),_e(),window.addEventListener("error",function(t){var e=t.target;if(e.src||e.href){var r=e.src||e.href;je({uuid:c(),type:"error",subType:"resource",startTime:Date.now(),url:r,html:e.outerHTML,pageUrl:location.href,path:t.path})}},!0),window.onerror=function(t,e,r,n,o){je({uuid:c(),type:"error",subType:"js",startTime:Date.now(),msg:t,url:e,lineNo:r,columnNo:n,stack:o.stack,pageUrl:location.href})},window.addEventListener("unhandledrejection",function(t){var e;je({type:"error",subType:"promise",startTime:Date.now(),reason:null===(e=t.reason)||void 0===e?void 0:e.stack,pageUrl:location.href})},!0)}};return me});
