!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MonitorSDK=e()}(this,function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var t=n.next();return c=t.done,t},e:function(t){u=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(u)throw i}}}}function r(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}var i={api:"http://127.0.0.1:4000/api",appId:"appId",isImgUpload:!1,batchSize:5,userId:""};function c(t){if(t&&"object"===a(t))for(var e in i)t[e]&&(i[e]=t[e])}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}var s="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,p=s||f||Function("return this")(),l=p.Symbol,b=Object.prototype,y=b.hasOwnProperty,v=b.toString,d=l?l.toStringTag:void 0;var h=Object.prototype.toString;var j=l?l.toStringTag:void 0;function g(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":j&&j in Object(t)?function(t){var e=y.call(t,d),r=t[d];try{t[d]=void 0;var n=!0}catch(t){}var o=v.call(t);return n&&(e?t[d]=r:delete t[d]),o}(t):function(t){return h.call(t)}(t)}function _(t){return null!=t&&"object"==typeof t}var m=Array.isArray;function w(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function O(t){if(!w(t))return!1;var e=g(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var x,A=p["__core-js_shared__"],S=(x=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"";var T=Function.prototype.toString;function P(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var I=/^\[object .+?Constructor\]$/,U=Function.prototype,E=Object.prototype,z=U.toString,D=E.hasOwnProperty,M=RegExp("^"+z.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function F(t){return!(!w(t)||(e=t,S&&S in e))&&(O(t)?M:I).test(P(t));var e}function k(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return F(r)?r:void 0}var L=k(p,"WeakMap"),N=Object.create,B=function(){function t(){}return function(e){if(!w(e))return{};if(N)return N(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),C=function(){try{var t=k(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var R=/^(?:0|[1-9]\d*)$/;function $(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&R.test(t))&&t>-1&&t%1==0&&t<e}function H(t,e){return t===e||t!=t&&e!=e}var q=Object.prototype.hasOwnProperty;function V(t,e,r){var n=t[e];q.call(t,e)&&H(n,r)&&(void 0!==r||e in t)||function(t,e,r){"__proto__"==e&&C?C(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}(t,e,r)}function W(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var J=Object.prototype;function G(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||J)}function K(t){return _(t)&&"[object Arguments]"==g(t)}var X=Object.prototype,Q=X.hasOwnProperty,Y=X.propertyIsEnumerable,Z=K(function(){return arguments}())?K:function(t){return _(t)&&Q.call(t,"callee")&&!Y.call(t,"callee")};var tt="object"==typeof exports&&exports&&!exports.nodeType&&exports,et=tt&&"object"==typeof module&&module&&!module.nodeType&&module,rt=et&&et.exports===tt?p.Buffer:void 0,nt=(rt?rt.isBuffer:void 0)||function(){return!1},ot={};function at(t){return function(e){return t(e)}}ot["[object Float32Array]"]=ot["[object Float64Array]"]=ot["[object Int8Array]"]=ot["[object Int16Array]"]=ot["[object Int32Array]"]=ot["[object Uint8Array]"]=ot["[object Uint8ClampedArray]"]=ot["[object Uint16Array]"]=ot["[object Uint32Array]"]=!0,ot["[object Arguments]"]=ot["[object Array]"]=ot["[object ArrayBuffer]"]=ot["[object Boolean]"]=ot["[object DataView]"]=ot["[object Date]"]=ot["[object Error]"]=ot["[object Function]"]=ot["[object Map]"]=ot["[object Number]"]=ot["[object Object]"]=ot["[object RegExp]"]=ot["[object Set]"]=ot["[object String]"]=ot["[object WeakMap]"]=!1;var it="object"==typeof exports&&exports&&!exports.nodeType&&exports,ct=it&&"object"==typeof module&&module&&!module.nodeType&&module,ut=ct&&ct.exports===it&&s.process,st=function(){try{var t=ct&&ct.require&&ct.require("util").types;return t||ut&&ut.binding&&ut.binding("util")}catch(t){}}(),ft=st&&st.isTypedArray,pt=ft?at(ft):function(t){return _(t)&&W(t.length)&&!!ot[g(t)]},lt=Object.prototype.hasOwnProperty;function bt(t,e){var r=m(t),n=!r&&Z(t),o=!r&&!n&&nt(t),a=!r&&!n&&!o&&pt(t),i=r||n||o||a,c=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=c.length;for(var s in t)!lt.call(t,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||$(s,u))||c.push(s);return c}function yt(t,e){return function(r){return t(e(r))}}var vt=yt(Object.keys,Object),dt=Object.prototype.hasOwnProperty;function ht(t){return null!=(e=t)&&W(e.length)&&!O(e)?bt(t):function(t){if(!G(t))return vt(t);var e=[];for(var r in Object(t))dt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t);var e}var jt=k(Object,"create");var gt=Object.prototype.hasOwnProperty;var _t=Object.prototype.hasOwnProperty;function mt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function wt(t,e){for(var r=t.length;r--;)if(H(t[r][0],e))return r;return-1}mt.prototype.clear=function(){this.__data__=jt?jt(null):{},this.size=0},mt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mt.prototype.get=function(t){var e=this.__data__;if(jt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return gt.call(e,t)?e[t]:void 0},mt.prototype.has=function(t){var e=this.__data__;return jt?void 0!==e[t]:_t.call(e,t)},mt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=jt&&void 0===e?"__lodash_hash_undefined__":e,this};var Ot=Array.prototype.splice;function xt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}xt.prototype.clear=function(){this.__data__=[],this.size=0},xt.prototype.delete=function(t){var e=this.__data__,r=wt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Ot.call(e,r,1),--this.size,!0)},xt.prototype.get=function(t){var e=this.__data__,r=wt(e,t);return r<0?void 0:e[r][1]},xt.prototype.has=function(t){return wt(this.__data__,t)>-1},xt.prototype.set=function(t,e){var r=this.__data__,n=wt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var At=k(p,"Map");function St(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Tt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Tt.prototype.clear=function(){this.size=0,this.__data__={hash:new mt,map:new(At||xt),string:new mt}},Tt.prototype.delete=function(t){var e=St(this,t).delete(t);return this.size-=e?1:0,e},Tt.prototype.get=function(t){return St(this,t).get(t)},Tt.prototype.has=function(t){return St(this,t).has(t)},Tt.prototype.set=function(t,e){var r=St(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Pt=yt(Object.getPrototypeOf,Object);function It(t){var e=this.__data__=new xt(t);this.size=e.size}It.prototype.clear=function(){this.__data__=new xt,this.size=0},It.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},It.prototype.get=function(t){return this.__data__.get(t)},It.prototype.has=function(t){return this.__data__.has(t)},It.prototype.set=function(t,e){var r=this.__data__;if(r instanceof xt){var n=r.__data__;if(!At||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Tt(n)}return r.set(t,e),this.size=r.size,this};var Ut="object"==typeof exports&&exports&&!exports.nodeType&&exports,Et=Ut&&"object"==typeof module&&module&&!module.nodeType&&module,zt=Et&&Et.exports===Ut?p.Buffer:void 0;zt&&zt.allocUnsafe;var Dt=Object.prototype.propertyIsEnumerable,Mt=Object.getOwnPropertySymbols,Ft=Mt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,a=[];++r<n;){var i=t[r];e(i,r,t)&&(a[o++]=i)}return a}(Mt(t),function(e){return Dt.call(t,e)}))}:function(){return[]};function kt(t){return function(t,e,r){var n=e(t);return m(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,ht,Ft)}var Lt=k(p,"DataView"),Nt=k(p,"Promise"),Bt=k(p,"Set"),Ct="[object Map]",Rt="[object Promise]",$t="[object Set]",Ht="[object WeakMap]",qt="[object DataView]",Vt=P(Lt),Wt=P(At),Jt=P(Nt),Gt=P(Bt),Kt=P(L),Xt=g;(Lt&&Xt(new Lt(new ArrayBuffer(1)))!=qt||At&&Xt(new At)!=Ct||Nt&&Xt(Nt.resolve())!=Rt||Bt&&Xt(new Bt)!=$t||L&&Xt(new L)!=Ht)&&(Xt=function(t){var e=g(t),r="[object Object]"==e?t.constructor:void 0,n=r?P(r):"";if(n)switch(n){case Vt:return qt;case Wt:return Ct;case Jt:return Rt;case Gt:return $t;case Kt:return Ht}return e});var Qt=Object.prototype.hasOwnProperty;var Yt=p.Uint8Array;function Zt(t){var e=new t.constructor(t.byteLength);return new Yt(e).set(new Yt(t)),e}var te=/\w*$/;var ee=l?l.prototype:void 0,re=ee?ee.valueOf:void 0;function ne(t,e,r){var n,o,a,i,c,u=t.constructor;switch(e){case"[object ArrayBuffer]":return Zt(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return c=Zt((i=t).buffer),new i.constructor(c,i.byteOffset,i.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t){var e=Zt(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return(a=new(o=t).constructor(o.source,te.exec(o))).lastIndex=o.lastIndex,a;case"[object Symbol]":return n=t,re?Object(re.call(n)):{}}}var oe=st&&st.isMap,ae=oe?at(oe):function(t){return _(t)&&"[object Map]"==Xt(t)};var ie=st&&st.isSet,ce=ie?at(ie):function(t){return _(t)&&"[object Set]"==Xt(t)},ue="[object Arguments]",se="[object Function]",fe="[object Object]",pe={};function le(t,e,r,n,o,a){var i;if(void 0!==i)return i;if(!w(t))return t;var c=m(t);if(c)i=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Qt.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t);else{var u=Xt(t),s=u==se||"[object GeneratorFunction]"==u;if(nt(t))return t.slice();if(u==fe||u==ue||s&&!o)i=s?{}:function(t){return"function"!=typeof t.constructor||G(t)?{}:B(Pt(t))}(t);else{if(!pe[u])return o?t:{};i=ne(t,u)}}a||(a=new It);var f=a.get(t);if(f)return f;a.set(t,i),ce(t)?t.forEach(function(n){i.add(le(n,e,r,n,t,a))}):ae(t)&&t.forEach(function(n,o){i.set(o,le(n,e,r,o,t,a))});var p=c?void 0:kt(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(p||t,function(n,o){p&&(n=t[o=n]),V(i,o,le(n,e,r,o,t,a))}),i}pe[ue]=pe["[object Array]"]=pe["[object ArrayBuffer]"]=pe["[object DataView]"]=pe["[object Boolean]"]=pe["[object Date]"]=pe["[object Float32Array]"]=pe["[object Float64Array]"]=pe["[object Int8Array]"]=pe["[object Int16Array]"]=pe["[object Int32Array]"]=pe["[object Map]"]=pe["[object Number]"]=pe[fe]=pe["[object RegExp]"]=pe["[object Set]"]=pe["[object String]"]=pe["[object Symbol]"]=pe["[object Uint8Array]"]=pe["[object Uint8ClampedArray]"]=pe["[object Uint16Array]"]=pe["[object Uint32Array]"]=!0,pe["[object Error]"]=pe[se]=pe["[object WeakMap]"]=!1;var be=[];function ye(t){be.push(t)}function ve(){return le(be,5)}function de(){be=[]}function he(t){if(navigator.sendBeacon)navigator.sendBeacon(i.url,t);else{var e=new XMLHttpRequest;e.setRequestHeader("Content-Type","application/json"),e.open("POST",i.url,!0),e.send(t)}}function je(t){if(!i.url)throw new Error("请设置上传 url 地址");var e=JSON.stringify({uuid:u(),userId:i.userId,data:t});i.isImgUpload?function(t){(new Image).src="".concat(i.url,"?data=").concat(encodeURIComponent(t))}(e):window.requestIdleCallback?window.requestIdleCallback(function(){he(e)},{timeout:3e3}):setTimeout(function(){he(e)})}function ge(t){ye(t);var e=ve();e.length>=i.batchSize&&(je(e),de())}function _e(){var t;(t=new PerformanceObserver(function(r){var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;"first-paint"===i.name&&(t.disconnect(),ge(o(o({},i.toJSON()),{},{type:"performance",subType:i.name,pageUrl:location.href})))}}catch(t){a.e(t)}finally{a.f()}})).observe({type:"paint",buffered:!0}),function(){var t=new PerformanceObserver(function(r){var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;"first-contentful-paint"===i.name&&(t.disconnect(),ge(o(o({},i.toJSON()),{},{type:"performance",subType:i.name,pageUrl:location.href})))}}catch(t){a.e(t)}finally{a.f()}});t.observe({type:"paint",buffered:!0})}(),function(){var t=new PerformanceObserver(function(r){t&&t.disconnect();var n,a=e(r.getEntries());try{for(a.s();!(n=a.n()).done;){var i=n.value;ge(o(o({},i.toJSON()),{},{type:"performance",subType:i.entryType,pageUrl:location.href}))}}catch(t){a.e(t)}finally{a.f()}});t.observe({type:"largest-contentful-paint",buffered:!0})}()}function me(){ge({uuid:u(),type:"behavior",subType:"pv",startTime:Date.now(),pageUrl:location.href,referror:document.referrer}),function(){var t="";window.addEventListener("hashchange",function(e){var r=e.newURL;ge({uuid:u(),type:"behavior",subType:"hashchange",startTime:Date.now(),form:t,to:r}),t=r},!0);var e="";window.addEventListener("popstate",function(t){var r=location.href;ge({uuid:u(),type:"behavior",subType:"popstate",startTime:Date.now(),form:e,to:r}),e=r},!0)}(),["mousedown","touchstart"].forEach(function(t){window.addEventListener(t,function(e){var r=e.target;r.tagName&&ge({uuid:u(),type:"behavior",subType:"click",startTime:Date.now(),target:r.tagName,innerHtml:r.innerHTML,outerHtml:r.outerHTML,width:r.offsetWidth,height:r.offsetHeight,eventType:t,path:e.path})})})}var we={init:function(t){c(t),_e(),me(),window.addEventListener("error",function(t){var e=t.target;if(e.src||e.href){var r=e.src||e.href;ge({uuid:u(),type:"error",subType:"resource",startTime:Date.now(),url:r,html:e.outerHTML,pageUrl:location.href,path:t.path})}},!0),window.onerror=function(t,e,r,n,o){ge({uuid:u(),type:"error",subType:"js",startTime:Date.now(),msg:t,url:e,lineNo:r,columnNo:n,stack:o.stack,pageUrl:location.href})},window.addEventListener("unhandledrejection",function(t){var e;ge({type:"error",subType:"promise",startTime:Date.now(),reason:null===(e=t.reason)||void 0===e?void 0:e.stack,pageUrl:location.href})},!0)},setConfig:c,batchReport:ge,report:je};return we});
